{% extends "base.html" %} {% block title %}Plants - Growatt API{% endblock %} {%
block styles %}
<!-- Plants specific styles -->
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/plants.css') }}"
/>
{% endblock %} {% block head_scripts %}
<!-- Plant utilities -->
<script src="{{ url_for('static', filename='js/utils/plant-data-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/utils/export-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/plants-app.js') }}"></script>
{% endblock %} {% block content %}
<div class="container mx-auto px-3 sm:px-4 md:px-6 py-3 sm:py-6">
  <div
    x-data="plantsApp()"
    x-init="init()"
    class="bg-gradient-mint rounded-xl shadow-md p-4 sm:p-6"
  >
    <div
      class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-3"
    >
      <h1
        class="text-xl sm:text-2xl md:text-3xl font-bold text-deep-forest font-headings"
      >
        Plants
      </h1>
      <div class="flex flex-wrap items-center gap-3 w-full sm:w-auto">
        <!-- View toggle buttons - Now visible on all screen sizes -->
        <div
          class="flex items-center bg-white rounded-lg p-1 shadow-sm border border-light-gray order-2 sm:order-1"
        >
          <button
            @click="viewMode = 'cards'; localStorage.setItem('preferredViewMode', 'cards')"
            class="px-3 py-1.5 rounded text-sm flex items-center gap-1.5 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-eco-green/50"
            :class="viewMode === 'cards' ? 'bg-eco-green text-white font-medium shadow-sm transform scale-105' : 'text-slate-gray hover:bg-snow-white'"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
              />
            </svg>
            <span class="hidden xs:inline">Cards</span>
          </button>
          <button
            @click="viewMode = 'table'; localStorage.setItem('preferredViewMode', 'table')"
            class="px-3 py-1.5 rounded text-sm flex items-center gap-1.5 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-eco-green/50"
            :class="viewMode === 'table' ? 'bg-eco-green text-white font-medium shadow-sm transform scale-105' : 'text-slate-gray hover:bg-snow-white'"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 10h18M3 14h18M3 18h18M3 6h18"
              />
            </svg>
            <span class="hidden xs:inline">Table</span>
          </button>
        </div>
        <button
          id="export-excel-button"
          class="bg-gradient-to-r from-blue-500 to-blue-600 text-white flex items-center gap-2 text-sm sm:text-base px-4 py-2 rounded-md shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-0.5 active:translate-y-0 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 w-full sm:w-auto order-3 sm:order-2 mt-2 sm:mt-0"
          @click="exportToExcel()"
          :disabled="isLoading || filteredPlants.length === 0"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"
            />
          </svg>
          <span class="font-medium">Export</span>
        </button>
        <button
          id="refresh-button"
          class="bg-gradient-to-r from-green-500 to-green-600 text-white flex items-center gap-2 text-sm sm:text-base px-4 py-2 rounded-md shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-0.5 active:translate-y-0 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 w-full sm:w-auto order-1 sm:order-3"
          @click="fetchPlants()"
          :disabled="isLoading"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            :class="{'animate-spin': isLoading}"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
          <span
            x-text="isLoading ? 'Loading...' : 'Refresh'"
            class="font-medium"
          ></span>
        </button>
      </div>
    </div>

    <!-- Search and filter toolbar (visible only when we have plants) -->
    <div x-show="!isLoading && plants.length > 0">
      {% include 'components/plants/search_filter.html' %}
    </div>

    <!-- Loading Spinner -->
    <div id="loading" x-show="isLoading">
      {% include 'components/plants/loading_spinner.html' %}
    </div>

    <!-- Error Message -->
    <div id="error-message" x-show="errorMessage">
      {% include 'components/plants/error_message.html' %}
    </div>

    <!-- Empty State -->
    <div x-show="!isLoading && plants.length === 0">
      {% include 'components/plants/empty_state.html' %}
    </div>

    <!-- Card view (optimized for mobile) -->
    <div
      x-show="!isLoading && plants.length > 0 && viewMode === 'cards'"
      x-transition
      class="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-5"
    >
      <template x-for="plant in paginatedPlants" :key="plant.id">
        {% include 'components/plants/plant_card.html' %}
      </template>
    </div>

    <!-- Table view -->
    <div
      x-show="!isLoading && plants.length > 0 && viewMode === 'table'"
      x-transition
    >
      {% include 'components/plants/plant_table.html' %}

      <!-- Table Pagination -->
      {% include 'components/common/pagination.html' %}
    </div>

    <!-- Card view pagination (appears at the bottom of card view) -->
    <div
      x-show="!isLoading && plants.length > 0 && viewMode === 'cards' && totalPages > 1"
    >
      {% include 'components/plants/card_pagination.html' %}
    </div>
  </div>
</div>
{% endblock %}

<div class="energy-management-container">
  <div class="energy-management-header">
    <h2 class="energy-management-title">
      Energy Management <span class="info-icon">â“˜</span>
    </h2>
    <div class="date-selector">
      <button class="date-navigation">&#10094;</button>
      <span class="current-date" id="selectedDate">2025-04-13</span>
      <button class="date-navigation">&#10095;</button>
    </div>
  </div>

  <div class="period-tabs">
    <button class="period-tab active">Day</button>
    <button class="period-tab">Month</button>
    <button class="period-tab">Year</button>
    <button class="period-tab">Lifetime</button>
  </div>

  <div class="energy-stats">
    <div class="energy-stat-container">
      <div class="energy-metric">
        <div class="energy-metric-label">Yield:</div>
        <span class="energy-metric-value" id="yieldValue">20.53</span>
        <span class="energy-metric-unit">kWh</span>
      </div>
      <div class="energy-metric">
        <span class="energy-metric-value" id="yieldTotal" style="color: #22c55e"
          >20.53</span
        >
        <div class="energy-metric-label">Consumed (kWh)</div>
      </div>
    </div>

    <div class="energy-stat-container">
      <div class="energy-metric">
        <div class="energy-metric-label">Consumption:</div>
        <span class="energy-metric-value" id="consumptionValue">77.56</span>
        <span class="energy-metric-unit">kWh</span>
      </div>
      <div class="energy-metric">
        <span
          class="energy-metric-value"
          id="gridFedValue"
          style="color: #10b981"
          >0.00</span
        >
        <div class="energy-metric-label">Fed to grid (kWh)</div>
      </div>
    </div>

    <div class="energy-stat-container">
      <div class="energy-metric">
        <span
          class="energy-metric-value"
          id="fromPvValue"
          style="color: #f59e0b"
          >20.53</span
        >
        <div class="energy-metric-label">From PV (kWh)</div>
      </div>
    </div>

    <div class="energy-stat-container">
      <div class="energy-metric">
        <span
          class="energy-metric-value"
          id="fromGridValue"
          style="color: #f59e0b"
          >57.03</span
        >
        <div class="energy-metric-label">From grid (kWh)</div>
      </div>
    </div>
  </div>

  <div class="energy-flow-visualization">
    <!-- Consumed from PV vs Grid bar -->
    <div class="energy-flow-bar">
      <div class="flow-segment consumed-segment" style="width: 100%">
        <span class="flow-segment-text">Consumed</span>
        <span class="flow-segment-percent">100.00%</span>
      </div>
    </div>

    <!-- Grid Interaction bar -->
    <div class="energy-flow-bar">
      <div class="flow-segment fed-grid-segment" style="width: 0%">
        <span class="flow-segment-text">Fed to grid</span>
        <span class="flow-segment-percent">0.00%</span>
      </div>
    </div>

    <!-- From PV vs Grid bar -->
    <div class="energy-flow-bar">
      <div class="flow-segment from-pv-segment" style="width: 26.47%">
        <span class="flow-segment-text">From PV</span>
        <span class="flow-segment-percent">26.47%</span>
      </div>
      <div class="flow-segment from-grid-segment" style="width: 73.53%">
        <span class="flow-segment-text">From grid</span>
        <span class="flow-segment-percent">73.53%</span>
      </div>
    </div>
  </div>

  <div class="energy-chart">
    <canvas id="energyFlowChart"></canvas>

    <!-- Sample tooltip that would be shown on hover -->
    <div class="chart-tooltip" style="display: none; top: 100px; left: 200px">
      <div class="tooltip-time">2025-04-13 09:50</div>
      <div class="tooltip-metric">
        <span class="tooltip-color pv-color"></span>
        <span class="tooltip-label">PV output</span>
        <span class="tooltip-value">7.372 kW</span>
      </div>
      <div class="tooltip-metric">
        <span class="tooltip-color consumption-color"></span>
        <span class="tooltip-label">Total consumption</span>
        <span class="tooltip-value">27.938 kW</span>
      </div>
      <div class="tooltip-metric">
        <span class="tooltip-color consumed-pv-color"></span>
        <span class="tooltip-label">Consumed from PV</span>
        <span class="tooltip-value">7.372 kW</span>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const ctx = document.getElementById("energyFlowChart").getContext("2d");

    // Sample data - replace with actual data from your API
    const chartData = {
      labels: Array.from({ length: 24 }, (_, i) => `${i}:00`),
      datasets: [
        {
          label: "PV output",
          data: [
            0, 0, 0, 0, 0, 0.1, 1.2, 3.5, 6.2, 10.5, 12.8, 14.2, 15.0, 14.6,
            13.2, 10.5, 6.8, 2.5, 0.2, 0, 0, 0, 0, 0,
          ],
          backgroundColor: "rgba(16, 185, 129, 0.2)",
          borderColor: "rgba(16, 185, 129, 1)",
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointRadius: 2,
        },
        {
          label: "Total consumption",
          data: [
            1.2, 1.1, 0.9, 0.8, 0.9, 1.0, 1.5, 2.8, 8.5, 14.2, 18.5, 22.0, 25.6,
            27.9, 25.2, 21.0, 16.5, 11.2, 8.5, 5.2, 3.8, 2.6, 1.8, 1.5,
          ],
          backgroundColor: "rgba(249, 115, 22, 0.2)",
          borderColor: "rgba(249, 115, 22, 1)",
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointRadius: 2,
        },
        {
          label: "Consumed from PV",
          data: [
            0, 0, 0, 0, 0, 0.1, 1.2, 3.5, 6.2, 10.5, 12.8, 14.2, 15.0, 14.6,
            13.2, 10.5, 6.8, 2.5, 0.2, 0, 0, 0, 0, 0,
          ],
          backgroundColor: "rgba(59, 130, 246, 0.2)",
          borderColor: "rgba(59, 130, 246, 1)",
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointRadius: 2,
        },
      ],
    };

    const config = {
      type: "line",
      data: chartData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: "index",
          intersect: false,
        },
        plugins: {
          legend: {
            display: false,
          },
          tooltip: {
            enabled: false, // We'll create our custom tooltip
            external: function (context) {
              // Custom tooltip implementation would go here
              // This is just a placeholder for the real implementation
            },
          },
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              color: "rgba(243, 244, 246, 0.7)",
              drawBorder: false,
            },
            ticks: {
              padding: 10,
              color: "#6b7280",
              callback: function (value) {
                return value + " kW";
              },
              font: {
                size: 11,
              },
            },
          },
          x: {
            grid: {
              display: false,
            },
            ticks: {
              padding: 10,
              color: "#6b7280",
              font: {
                size: 11,
              },
            },
          },
        },
      },
    };

    const energyFlowChart = new Chart(ctx, config);

    // Add event listener for date navigation
    document.querySelectorAll(".date-navigation").forEach((button) => {
      button.addEventListener("click", function () {
        // Date navigation functionality would go here
        // This is just a placeholder for the real implementation
      });
    });

    // Add event listeners for period tabs
    document.querySelectorAll(".period-tab").forEach((tab) => {
      tab.addEventListener("click", function () {
        document
          .querySelectorAll(".period-tab")
          .forEach((t) => t.classList.remove("active"));
        this.classList.add("active");

        // Period change functionality would go here
        // This would update the chart data based on the selected period
      });
    });

    // Function to show custom tooltip
    function showTooltip(chart, position, data) {
      const tooltip = document.querySelector(".chart-tooltip");
      tooltip.style.display = "block";
      tooltip.style.left = position.x + "px";
      tooltip.style.top = position.y + "px";

      // Update tooltip content
      tooltip.querySelector(".tooltip-time").textContent = data.time;
      tooltip.querySelectorAll(".tooltip-value")[0].textContent =
        data.pvOutput + " kW";
      tooltip.querySelectorAll(".tooltip-value")[1].textContent =
        data.consumption + " kW";
      tooltip.querySelectorAll(".tooltip-value")[2].textContent =
        data.consumedPv + " kW";
    }

    // Function to hide custom tooltip
    function hideTooltip() {
      const tooltip = document.querySelector(".chart-tooltip");
      tooltip.style.display = "none";
    }

    // In a real implementation, you would use Chart.js event handlers to show/hide the tooltip
    // This is just a placeholder for demonstration purposes
  });
</script>

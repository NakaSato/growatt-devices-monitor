<!-- Performance Component -->
<div class="space-y-6">
  <!-- Header Section -->
  <div class="bg-white shadow rounded-lg p-4 sm:p-6">
    <div class="md:flex md:items-center md:justify-between mb-4">
      <h2 class="text-xl font-bold leading-tight text-gray-900">
        System Performance
      </h2>
      <div class="mt-3 md:mt-0 flex space-x-2">
        <button
          @click="refreshPerformanceData()"
          class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-2"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
          Refresh Data
        </button>
        <button
          @click="downloadPerformanceReport()"
          class="inline-flex items-center px-4 py-2 border border-primary-600 text-sm font-medium rounded-md text-primary-600 bg-white hover:bg-primary-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-2"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            />
          </svg>
          Download Report
        </button>
      </div>
    </div>

    <!-- Performance Summary Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <!-- Overall Performance Score -->
      <div class="bg-green-50 border border-green-200 rounded-lg p-4">
        <div class="flex items-center">
          <div class="flex-shrink-0 bg-green-100 rounded-full p-3">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-green-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-semibold text-gray-800">Overall Score</h3>
            <p
              class="text-2xl font-bold"
              x-text="operationsData.performance?.overallScore || '92%'"
            ></p>
            <p class="text-sm text-gray-600">
              <span
                x-show="operationsData.performance?.scoreChange > 0"
                class="text-green-600"
                >↑</span
              >
              <span
                x-show="operationsData.performance?.scoreChange < 0"
                class="text-red-600"
                >↓</span
              >
              <span
                x-text="Math.abs(operationsData.performance?.scoreChange || 2) + '%'"
              ></span>
              vs last month
            </p>
          </div>
        </div>
      </div>

      <!-- Energy Efficiency -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-center">
          <div class="flex-shrink-0 bg-blue-100 rounded-full p-3">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-blue-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"
              />
            </svg>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-semibold text-gray-800">Efficiency</h3>
            <p
              class="text-2xl font-bold"
              x-text="operationsData.performance?.efficiency || '95%'"
            ></p>
            <p class="text-sm text-gray-600">Energy conversion rate</p>
          </div>
        </div>
      </div>

      <!-- Uptime -->
      <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
        <div class="flex items-center">
          <div class="flex-shrink-0 bg-purple-100 rounded-full p-3">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-purple-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-semibold text-gray-800">Uptime</h3>
            <p
              class="text-2xl font-bold"
              x-text="operationsData.performance?.uptime || '99.8%'"
            ></p>
            <p class="text-sm text-gray-600">Last 30 days</p>
          </div>
        </div>
      </div>

      <!-- Energy Production -->
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <div class="flex items-center">
          <div class="flex-shrink-0 bg-yellow-100 rounded-full p-3">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-yellow-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"
              />
            </svg>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-semibold text-gray-800">Production</h3>
            <p
              class="text-2xl font-bold"
              x-text="operationsData.performance?.productionKWh || '1,284 kWh'"
            ></p>
            <p class="text-sm text-gray-600">This month</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Time Range Selector -->
    <div class="bg-white border border-gray-200 rounded-md p-4 mb-6">
      <div class="sm:flex sm:items-center sm:justify-between">
        <div>
          <h3 class="text-lg font-medium text-gray-900">Performance Trends</h3>
          <p class="mt-1 text-sm text-gray-500">
            View performance metrics over time
          </p>
        </div>
        <div class="mt-3 sm:mt-0 sm:ml-4">
          <div class="flex rounded-md shadow-sm">
            <button
              type="button"
              @click="performanceTimeRange = 'day'"
              :class="{ 'bg-primary-100 text-primary-700': performanceTimeRange === 'day' }"
              class="inline-flex items-center px-4 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500"
            >
              Day
            </button>
            <button
              type="button"
              @click="performanceTimeRange = 'week'"
              :class="{ 'bg-primary-100 text-primary-700': performanceTimeRange === 'week' }"
              class="-ml-px inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500"
            >
              Week
            </button>
            <button
              type="button"
              @click="performanceTimeRange = 'month'"
              :class="{ 'bg-primary-100 text-primary-700': performanceTimeRange === 'month' }"
              class="-ml-px inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500"
            >
              Month
            </button>
            <button
              type="button"
              @click="performanceTimeRange = 'year'"
              :class="{ 'bg-primary-100 text-primary-700': performanceTimeRange === 'year' }"
              class="-ml-px inline-flex items-center px-4 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500"
            >
              Year
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <!-- Energy Production Chart -->
      <div class="bg-white border border-gray-200 rounded-md p-4">
        <div class="mb-4">
          <h3 class="text-lg font-medium text-gray-900">Energy Production</h3>
          <p class="mt-1 text-sm text-gray-500">Daily energy output in kWh</p>
        </div>
        <div class="h-72">
          <canvas id="energyProductionChart"></canvas>
        </div>
      </div>

      <!-- Efficiency Comparison Chart -->
      <div class="bg-white border border-gray-200 rounded-md p-4">
        <div class="mb-4">
          <h3 class="text-lg font-medium text-gray-900">
            Efficiency Comparison
          </h3>
          <p class="mt-1 text-sm text-gray-500">
            Comparing actual vs expected performance
          </p>
        </div>
        <div class="h-72">
          <canvas id="efficiencyComparisonChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Performance Metrics Table -->
    <div class="bg-white border border-gray-200 rounded-md overflow-hidden">
      <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
        <h3 class="text-lg font-medium leading-6 text-gray-900">
          Detailed Performance Metrics
        </h3>
        <p class="mt-1 max-w-2xl text-sm text-gray-500">
          Key performance indicators for all monitored systems
        </p>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Plant Name
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Efficiency
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Output (kWh)
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Performance Ratio
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Uptime
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Status
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <!-- Plant performance rows template -->
            <template
              x-for="(plant, index) in operationsData.plants || []"
              :key="index"
            >
              <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="flex-shrink-0 h-10 w-10">
                      <span
                        class="h-10 w-10 rounded-full flex items-center justify-center bg-primary-100 text-primary-800 text-lg font-semibold"
                        x-text="plant.name ? plant.name.charAt(0).toUpperCase() : 'P'"
                      ></span>
                    </div>
                    <div class="ml-4">
                      <div
                        class="text-sm font-medium text-gray-900"
                        x-text="plant.name || 'Plant ' + (index + 1)"
                      ></div>
                      <div
                        class="text-sm text-gray-500"
                        x-text="plant.location || 'Unknown location'"
                      ></div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div
                    class="text-sm text-gray-900"
                    x-text="(plant.performance?.efficiency || '94') + '%'"
                  ></div>
                  <div class="text-xs text-gray-500">
                    <span
                      x-show="(plant.performance?.efficiencyChange || 0) > 0"
                      class="text-green-600"
                      >↑</span
                    >
                    <span
                      x-show="(plant.performance?.efficiencyChange || 0) < 0"
                      class="text-red-600"
                      >↓</span
                    >
                    <span
                      x-text="Math.abs(plant.performance?.efficiencyChange || 1.2) + '%'"
                    ></span>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div
                    class="text-sm text-gray-900"
                    x-text="plant.performance?.output || '382 kWh'"
                  ></div>
                  <div class="text-xs text-gray-500">Today</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div
                    class="text-sm text-gray-900"
                    x-text="(plant.performance?.performanceRatio || '0.89')"
                  ></div>
                  <div class="text-xs text-gray-500">PR</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div
                    class="text-sm text-gray-900"
                    x-text="(plant.performance?.uptime || '99.7') + '%'"
                  ></div>
                  <div class="text-xs text-gray-500">Last 30 days</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span
                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                    :class="{
                      'bg-green-100 text-green-800': plant.performance?.status === 'optimal',
                      'bg-yellow-100 text-yellow-800': plant.performance?.status === 'acceptable',
                      'bg-red-100 text-red-800': plant.performance?.status === 'underperforming'
                    }"
                    x-text="plant.performance?.status || 'optimal'"
                  >
                  </span>
                </td>
              </tr>
            </template>
            <!-- Fallback rows for when no data is available -->
            <template
              x-if="!operationsData.plants || operationsData.plants.length === 0"
            >
              <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="flex-shrink-0 h-10 w-10">
                      <span
                        class="h-10 w-10 rounded-full flex items-center justify-center bg-primary-100 text-primary-800 text-lg font-semibold"
                        >S</span
                      >
                    </div>
                    <div class="ml-4">
                      <div class="text-sm font-medium text-gray-900">
                        Solar Plant Alpha
                      </div>
                      <div class="text-sm text-gray-500">Main Location</div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900">94%</div>
                  <div class="text-xs text-green-600">↑ 1.2%</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900">382 kWh</div>
                  <div class="text-xs text-gray-500">Today</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900">0.89</div>
                  <div class="text-xs text-gray-500">PR</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900">99.7%</div>
                  <div class="text-xs text-gray-500">Last 30 days</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span
                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"
                  >
                    optimal
                  </span>
                </td>
              </tr>
              <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="flex-shrink-0 h-10 w-10">
                      <span
                        class="h-10 w-10 rounded-full flex items-center justify-center bg-primary-100 text-primary-800 text-lg font-semibold"
                        >B</span
                      >
                    </div>
                    <div class="ml-4">
                      <div class="text-sm font-medium text-gray-900">
                        Beta Solar Farm
                      </div>
                      <div class="text-sm text-gray-500">
                        Secondary Location
                      </div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900">91%</div>
                  <div class="text-xs text-red-600">↓ 0.5%</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900">276 kWh</div>
                  <div class="text-xs text-gray-500">Today</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900">0.82</div>
                  <div class="text-xs text-gray-500">PR</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900">98.5%</div>
                  <div class="text-xs text-gray-500">Last 30 days</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span
                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800"
                  >
                    acceptable
                  </span>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("alpine:init", () => {
    // Extend operationsApp with performance functionality
    Alpine.data("operationsApp", () => ({
      // Existing properties

      // Additional properties for performance
      performanceTimeRange: 'month',

      // Add to init() method if needed
      initPerformanceCharts() {
        // Initialize charts when tab becomes active
        if (this.activeTab === 'performance') {
          this.renderPerformanceCharts();
        }
      },

      // Watch for tab changes to initialize charts
      $watch('activeTab', (value) => {
        if (value === 'performance') {
          setTimeout(() => {
            this.renderPerformanceCharts();
          }, 100);
        }
      }),

      // Methods for performance
      refreshPerformanceData() {
        // Refresh performance data
        this.refreshOperationsData();
        setTimeout(() => {
          this.renderPerformanceCharts();
        }, 500);
      },

      downloadPerformanceReport() {
        // Generate and download performance report
        window.location.href = "/api/operations/performance/report";
      },

      renderPerformanceCharts() {
        // Energy Production Chart
        const productionCtx = document.getElementById('energyProductionChart');
        if (productionCtx) {
          // Check if Chart instance already exists
          if (productionCtx._chart) {
            productionCtx._chart.destroy();
          }

          // Sample data - would come from API in real implementation
          const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
          const production = [125, 132, 101, 134, 90, 130, 120];

          productionCtx._chart = new Chart(productionCtx, {
            type: 'bar',
            data: {
              labels: days,
              datasets: [{
                label: 'Energy Production (kWh)',
                data: production,
                backgroundColor: 'rgba(59, 130, 246, 0.5)',
                borderColor: 'rgba(59, 130, 246, 1)',
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: 'kWh'
                  }
                }
              }
            }
          });
        }

        // Efficiency Comparison Chart
        const efficiencyCtx = document.getElementById('efficiencyComparisonChart');
        if (efficiencyCtx) {
          // Check if Chart instance already exists
          if (efficiencyCtx._chart) {
            efficiencyCtx._chart.destroy();
          }

          // Sample data - would come from API in real implementation
          const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
          const actual = [88, 90, 92, 91, 93, 94];
          const expected = [90, 90, 90, 90, 90, 90];

          efficiencyCtx._chart = new Chart(efficiencyCtx, {
            type: 'line',
            data: {
              labels: months,
              datasets: [
                {
                  label: 'Actual Efficiency (%)',
                  data: actual,
                  backgroundColor: 'rgba(16, 185, 129, 0.2)',
                  borderColor: 'rgba(16, 185, 129, 1)',
                  borderWidth: 2,
                  tension: 0.3
                },
                {
                  label: 'Expected Efficiency (%)',
                  data: expected,
                  backgroundColor: 'rgba(245, 158, 11, 0.2)',
                  borderColor: 'rgba(245, 158, 11, 1)',
                  borderWidth: 2,
                  borderDash: [5, 5],
                  tension: 0.3
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: false,
                  min: 80,
                  title: {
                    display: true,
                    text: 'Efficiency (%)'
                  }
                }
              }
            }
          });
        }
      }
    }));
  });
</script>
